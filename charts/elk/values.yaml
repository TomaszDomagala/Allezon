eck-stack:
  eck-elasticsearch:
    enabled: true
    fullnameOverride: elasticsearch
    annotations:
      eck.k8s.elastic.co/license: basic

  eck-kibana:
    enabled: true
    fullnameOverride: kibana
    annotations:
      eck.k8s.elastic.co/license: basic

  eck-beats:
    enabled: true
    annotations:
      eck.k8s.elastic.co/license: basic
    fullnameOverride: filebeat
    spec:
      type: filebeat
      version: 7.15.0
      elasticsearchRef:
        name: elasticsearch
      kibanaRef:
        name: kibana
      config:
        filebeat:
          inputs:
            - type: container
              paths:
                - /var/log/containers/*.log
#          autodiscover:
#            providers:
#              - type: kubernetes
#                hints.enabled: true
#        processors:
#          - add_kubernetes_metadata:
#              default_indexers.enabled: true
#              default_matchers.enabled: true

      daemonSet:
        podTemplate:
          spec:
            dnsPolicy: ClusterFirstWithHostNet
            hostNetwork: true
#            automountServiceAccountToken: true
            securityContext:
              runAsUser: 0
            containers:
              - name: filebeat
                volumeMounts:
                  - name: varlogcontainers
                    mountPath: /var/log/containers
                  - name: varlogpods
                    mountPath: /var/log/pods
                  - name: varlibdockercontainers
                    mountPath: /var/lib/docker/containers
            volumes:
              - name: varlogcontainers
                hostPath:
                  path: /var/log/containers
              - name: varlogpods
                hostPath:
                  path: /var/log/pods
              - name: varlibdockercontainers
                hostPath:
                  path: /var/lib/docker/containers




#  eck-beats:
#    enabled: true
#    annotations:
#      eck.k8s.elastic.co/license: basic
#    name: filebeat
#    spec:
#      type: filebeat
#      elasticsearchRef:
#        name: elasticsearch
#      kibanaRef:
#        name: kibana
#      config:
#        filebeat:
#          inputs:
#            - type: container
#              paths:
#                - /var/log/containers/*.log
#              processors:
#                - add_kubernetes_metadata:
#                    host: ${NODE_NAME}
#                    matchers:
#                      - logs_path:
#                          logs_path: "/var/log/containers/"
#
#          autodiscover:
#            providers:
#              - node: ${NODE_NAME}
#                hints:
#                  enabled: true
#                  default_config:
#                    type: container
#                    paths:
#                      - /var/log/containers/*${data.kubernetes.container.id}.log
#      daemonSet:
#        podTemplate:
#          spec:
#            serviceAccountName: filebeat-service-account
#            automountServiceAccountToken: true
#            containers:
#              - name: filebeat
#                env:
#                  - name: NODE_NAME
#                    valueFrom:
#                      fieldRef:
#                        fieldPath: spec.nodeName
#            volumes:
#              - name: beat-data
#                emptyDir: {}
#
#    serviceAccount:
#      name: filebeat-service-account